{
  "stats": {
    "suites": 31,
    "tests": 59,
    "passes": 29,
    "pending": 0,
    "failures": 30,
    "start": "2017-10-31T01:32:06.752Z",
    "end": "2017-10-31T01:32:10.941Z",
    "duration": 4189,
    "testsRegistered": 59,
    "passPercent": 49.2,
    "pendingPercent": 0,
    "other": 0,
    "hasOther": false,
    "skipped": 0,
    "hasSkipped": false,
    "passPercentClass": "danger",
    "pendingPercentClass": "danger"
  },
  "suites": {
    "title": "",
    "suites": [
      {
        "title": "app",
        "suites": [],
        "tests": [
          {
            "title": "should handle socket errors",
            "fullTitle": "app should handle socket errors",
            "timedOut": true,
            "duration": 2007,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.use(function *(next){\n  // triggers this.socket.writable == false\n  this.socket.emit('error', new Error('boom'));\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
            "err": {
              "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
              "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
            },
            "isRoot": false,
            "uuid": "641c0b23-c5ca-4d08-b4fc-f980769e69a1",
            "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not .writeHead when !socket.writable",
            "fullTitle": "app should not .writeHead when !socket.writable",
            "timedOut": false,
            "duration": 3,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "var app = koa();\napp.use(function *(next){\n  // set .writable to false\n  this.socket.writable = false;\n  this.status = 204;\n  // throw if .writeHead or .end is called\n  this.res.writeHead =\n  this.res.end = function(){\n    throw new Error('response sent');\n  };\n})\n// hackish, but the response should occur in a single tick\nsetImmediate(done);\nrequest(app.listen())\n.get('/')\n.end(function(){});",
            "err": {},
            "isRoot": false,
            "uuid": "e4b08348-010b-484d-9600-22eac21434a0",
            "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should set development env when NODE_ENV missing",
            "fullTitle": "app should set development env when NODE_ENV missing",
            "timedOut": false,
            "duration": 0,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "var NODE_ENV = process.env.NODE_ENV;\nprocess.env.NODE_ENV = '';\nvar app = koa();\nprocess.env.NODE_ENV = NODE_ENV;\nassert.equal(app.env, 'development');",
            "err": {},
            "isRoot": false,
            "uuid": "e964ad37-0db4-489f-bcd8-436713cbcf2c",
            "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [
          {
            "title": "should not .writeHead when !socket.writable",
            "fullTitle": "app should not .writeHead when !socket.writable",
            "timedOut": false,
            "duration": 3,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "var app = koa();\napp.use(function *(next){\n  // set .writable to false\n  this.socket.writable = false;\n  this.status = 204;\n  // throw if .writeHead or .end is called\n  this.res.writeHead =\n  this.res.end = function(){\n    throw new Error('response sent');\n  };\n})\n// hackish, but the response should occur in a single tick\nsetImmediate(done);\nrequest(app.listen())\n.get('/')\n.end(function(){});",
            "err": {},
            "isRoot": false,
            "uuid": "e4b08348-010b-484d-9600-22eac21434a0",
            "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should set development env when NODE_ENV missing",
            "fullTitle": "app should set development env when NODE_ENV missing",
            "timedOut": false,
            "duration": 0,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "var NODE_ENV = process.env.NODE_ENV;\nprocess.env.NODE_ENV = '';\nvar app = koa();\nprocess.env.NODE_ENV = NODE_ENV;\nassert.equal(app.env, 'development');",
            "err": {},
            "isRoot": false,
            "uuid": "e964ad37-0db4-489f-bcd8-436713cbcf2c",
            "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
            "isHook": false,
            "skipped": false
          }
        ],
        "failures": [
          {
            "title": "should handle socket errors",
            "fullTitle": "app should handle socket errors",
            "timedOut": true,
            "duration": 2007,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.use(function *(next){\n  // triggers this.socket.writable == false\n  this.socket.emit('error', new Error('boom'));\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
            "err": {
              "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
              "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
            },
            "isRoot": false,
            "uuid": "641c0b23-c5ca-4d08-b4fc-f980769e69a1",
            "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
            "isHook": false,
            "skipped": false
          }
        ],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 3,
        "totalPasses": 2,
        "totalFailures": 1,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": true,
        "hasFailures": true,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 2010,
        "rootEmpty": false
      },
      {
        "title": "app.toJSON()",
        "suites": [],
        "tests": [
          {
            "title": "should work",
            "fullTitle": "app.toJSON() should work",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar obj = app.toJSON();\nobj.should.eql({\n  subdomainOffset: 2,\n  proxy: false,\n  env: 'test'\n});",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:69:15)"
            },
            "isRoot": false,
            "uuid": "a28e7671-a15e-423a-9761-1ec60dec35c2",
            "parentUUID": "8b74cd26-5c31-4d9b-ba0d-6f4668b6e1a0",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "8b74cd26-5c31-4d9b-ba0d-6f4668b6e1a0",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [],
        "failures": [
          {
            "title": "should work",
            "fullTitle": "app.toJSON() should work",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar obj = app.toJSON();\nobj.should.eql({\n  subdomainOffset: 2,\n  proxy: false,\n  env: 'test'\n});",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:69:15)"
            },
            "isRoot": false,
            "uuid": "a28e7671-a15e-423a-9761-1ec60dec35c2",
            "parentUUID": "8b74cd26-5c31-4d9b-ba0d-6f4668b6e1a0",
            "isHook": false,
            "skipped": false
          }
        ],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 1,
        "totalPasses": 0,
        "totalFailures": 1,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": false,
        "hasFailures": true,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 0,
        "rootEmpty": false
      },
      {
        "title": "app.inspect()",
        "suites": [],
        "tests": [
          {
            "title": "should work",
            "fullTitle": "app.inspect() should work",
            "timedOut": false,
            "duration": 3,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar util = require('util');\nvar str = util.inspect(app);\nassert.equal(\"{ subdomainOffset: 2, proxy: false, env: 'test' }\", str);",
            "err": {
              "message": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'",
              "estack": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'\n    at Context.<anonymous> (test/application.js:82:12)",
              "diff": "- { subdomainOffset: 2, proxy: false, env: 'test' }\n+ { subdomainOffset: 2, proxy: false, env: 'undefined' }\n"
            },
            "isRoot": false,
            "uuid": "a0d003d7-8d34-4ca1-823e-32626b3b20c6",
            "parentUUID": "73350234-abae-45dd-abb8-ca709c897710",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "73350234-abae-45dd-abb8-ca709c897710",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [],
        "failures": [
          {
            "title": "should work",
            "fullTitle": "app.inspect() should work",
            "timedOut": false,
            "duration": 3,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar util = require('util');\nvar str = util.inspect(app);\nassert.equal(\"{ subdomainOffset: 2, proxy: false, env: 'test' }\", str);",
            "err": {
              "message": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'",
              "estack": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'\n    at Context.<anonymous> (test/application.js:82:12)",
              "diff": "- { subdomainOffset: 2, proxy: false, env: 'test' }\n+ { subdomainOffset: 2, proxy: false, env: 'undefined' }\n"
            },
            "isRoot": false,
            "uuid": "a0d003d7-8d34-4ca1-823e-32626b3b20c6",
            "parentUUID": "73350234-abae-45dd-abb8-ca709c897710",
            "isHook": false,
            "skipped": false
          }
        ],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 1,
        "totalPasses": 0,
        "totalFailures": 1,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": false,
        "hasFailures": true,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 3,
        "rootEmpty": false
      },
      {
        "title": "app.use(fn)",
        "suites": [],
        "tests": [
          {
            "title": "should compose middleware",
            "fullTitle": "app.use(fn) should compose middleware",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar calls = [];\napp.use(function *(next){\n  calls.push(1);\n  yield next;\n  calls.push(6);\n});\napp.use(function *(next){\n  calls.push(2);\n  yield next;\n  calls.push(5);\n});\napp.use(function *(next){\n  calls.push(3);\n  yield next;\n  calls.push(4);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404)\n.end(function(err){\n  if (err) return done(err);\n  calls.should.eql([1,2,3,4,5,6]);\n  done();\n});",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Test.<anonymous> (test/application.js:116:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
            },
            "isRoot": false,
            "uuid": "8177e9bf-2589-412e-a46b-28d20c145fe2",
            "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should error when a non-generator function is passed",
            "fullTitle": "app.use(fn) should error when a non-generator function is passed",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\ntry {\n  app.use(function(){});\n} catch (err) {\n  err.message.should.equal('app.use() requires a generator function');\n}",
            "err": {
              "message": "TypeError: Cannot read property 'equal' of undefined",
              "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Context.<anonymous> (test/application.js:127:25)"
            },
            "isRoot": false,
            "uuid": "69805d01-fc25-433e-bde6-80ff8a3c3c4c",
            "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not error when a non-generator function is passed when .experimental=true",
            "fullTitle": "app.use(fn) should not error when a non-generator function is passed when .experimental=true",
            "timedOut": false,
            "duration": 0,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "var app = koa();\napp.experimental = true;\napp.use(function(){});",
            "err": {},
            "isRoot": false,
            "uuid": "5fa9b996-9292-45de-8bf2-6b059f006f36",
            "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [
          {
            "title": "should not error when a non-generator function is passed when .experimental=true",
            "fullTitle": "app.use(fn) should not error when a non-generator function is passed when .experimental=true",
            "timedOut": false,
            "duration": 0,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "var app = koa();\napp.experimental = true;\napp.use(function(){});",
            "err": {},
            "isRoot": false,
            "uuid": "5fa9b996-9292-45de-8bf2-6b059f006f36",
            "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
            "isHook": false,
            "skipped": false
          }
        ],
        "failures": [
          {
            "title": "should compose middleware",
            "fullTitle": "app.use(fn) should compose middleware",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar calls = [];\napp.use(function *(next){\n  calls.push(1);\n  yield next;\n  calls.push(6);\n});\napp.use(function *(next){\n  calls.push(2);\n  yield next;\n  calls.push(5);\n});\napp.use(function *(next){\n  calls.push(3);\n  yield next;\n  calls.push(4);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404)\n.end(function(err){\n  if (err) return done(err);\n  calls.should.eql([1,2,3,4,5,6]);\n  done();\n});",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Test.<anonymous> (test/application.js:116:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
            },
            "isRoot": false,
            "uuid": "8177e9bf-2589-412e-a46b-28d20c145fe2",
            "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should error when a non-generator function is passed",
            "fullTitle": "app.use(fn) should error when a non-generator function is passed",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\ntry {\n  app.use(function(){});\n} catch (err) {\n  err.message.should.equal('app.use() requires a generator function');\n}",
            "err": {
              "message": "TypeError: Cannot read property 'equal' of undefined",
              "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Context.<anonymous> (test/application.js:127:25)"
            },
            "isRoot": false,
            "uuid": "69805d01-fc25-433e-bde6-80ff8a3c3c4c",
            "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
            "isHook": false,
            "skipped": false
          }
        ],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 3,
        "totalPasses": 1,
        "totalFailures": 2,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": true,
        "hasFailures": true,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 0,
        "rootEmpty": false
      },
      {
        "title": "app.onerror(err)",
        "suites": [],
        "tests": [
          {
            "title": "should throw an error if a non-error is given",
            "fullTitle": "app.onerror(err) should throw an error if a non-error is given",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\ntry {\n  app.onerror('foo');\n  should.fail();\n} catch (err) {\n  err.should.be.instanceOf(AssertionError);\n  err.message.should.equal('non-error thrown: foo');\n}\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'be' of undefined",
              "estack": "TypeError: Cannot read property 'be' of undefined\n    at Context.<anonymous> (test/application.js:147:17)"
            },
            "isRoot": false,
            "uuid": "358fb66c-7786-4af2-b5b1-96f23f6a2f02",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should do nothing if status is 404",
            "fullTitle": "app.onerror(err) should do nothing if status is 404",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar err = new Error();\nerr.status = 404;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:164:18)"
            },
            "isRoot": false,
            "uuid": "fd7cbfdd-5741-4f08-94aa-396404120cd7",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should do nothing if .silent",
            "fullTitle": "app.onerror(err) should do nothing if .silent",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.silent = true;\nvar err = new Error();\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:178:18)"
            },
            "isRoot": false,
            "uuid": "0ddf2c30-9286-4d0b-a67d-5143b9dc0ac8",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should log the error to stderr",
            "fullTitle": "app.onerror(err) should log the error to stderr",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error();\nerr.stack = 'Foo';\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Foo\\n\", \"\\n\"]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:194:18)"
            },
            "isRoot": false,
            "uuid": "29e363fd-acdc-41e7-a1b3-ae26973e084b",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should use err.toString() instad of err.stack",
            "fullTitle": "app.onerror(err) should use err.toString() instad of err.stack",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error('mock stack null');\nerr.stack = null;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Error: mock stack null\\n\", \"\\n\"]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:210:18)"
            },
            "isRoot": false,
            "uuid": "d9915255-f6ab-458b-a2e4-abba6291c7d7",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "1a701163-3898-4eba-9461-92eeb1d03021",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [],
        "failures": [
          {
            "title": "should throw an error if a non-error is given",
            "fullTitle": "app.onerror(err) should throw an error if a non-error is given",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\ntry {\n  app.onerror('foo');\n  should.fail();\n} catch (err) {\n  err.should.be.instanceOf(AssertionError);\n  err.message.should.equal('non-error thrown: foo');\n}\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'be' of undefined",
              "estack": "TypeError: Cannot read property 'be' of undefined\n    at Context.<anonymous> (test/application.js:147:17)"
            },
            "isRoot": false,
            "uuid": "358fb66c-7786-4af2-b5b1-96f23f6a2f02",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should do nothing if status is 404",
            "fullTitle": "app.onerror(err) should do nothing if status is 404",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\nvar err = new Error();\nerr.status = 404;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:164:18)"
            },
            "isRoot": false,
            "uuid": "fd7cbfdd-5741-4f08-94aa-396404120cd7",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should do nothing if .silent",
            "fullTitle": "app.onerror(err) should do nothing if .silent",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.silent = true;\nvar err = new Error();\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:178:18)"
            },
            "isRoot": false,
            "uuid": "0ddf2c30-9286-4d0b-a67d-5143b9dc0ac8",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should log the error to stderr",
            "fullTitle": "app.onerror(err) should log the error to stderr",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error();\nerr.stack = 'Foo';\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Foo\\n\", \"\\n\"]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:194:18)"
            },
            "isRoot": false,
            "uuid": "29e363fd-acdc-41e7-a1b3-ae26973e084b",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should use err.toString() instad of err.stack",
            "fullTitle": "app.onerror(err) should use err.toString() instad of err.stack",
            "timedOut": false,
            "duration": 0,
            "state": "failed",
            "pass": false,
            "fail": true,
            "pending": false,
            "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error('mock stack null');\nerr.stack = null;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Error: mock stack null\\n\", \"\\n\"]);\ndone();",
            "err": {
              "message": "TypeError: Cannot read property 'eql' of undefined",
              "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:210:18)"
            },
            "isRoot": false,
            "uuid": "d9915255-f6ab-458b-a2e4-abba6291c7d7",
            "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
            "isHook": false,
            "skipped": false
          }
        ],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 5,
        "totalPasses": 0,
        "totalFailures": 5,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": false,
        "hasFailures": true,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 0,
        "rootEmpty": false
      },
      {
        "title": "app.respond",
        "suites": [
          {
            "title": "when this.respond === false",
            "suites": [],
            "tests": [
              {
                "title": "should bypass app.respond",
                "fullTitle": "app.respond when this.respond === false should bypass app.respond",
                "timedOut": false,
                "duration": 5,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n  this.respond = false;\n  var res = this.res;\n  res.statusCode = 200;\n  setImmediate(function(){\n    res.setHeader('Content-Type', 'text/plain');\n    res.end('lol');\n  })\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('lol')\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "d4757f82-922f-423b-9d41-20e0a6b52b47",
                "parentUUID": "3b1616fc-ba5a-442d-a120-56ae802163dc",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "3b1616fc-ba5a-442d-a120-56ae802163dc",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should bypass app.respond",
                "fullTitle": "app.respond when this.respond === false should bypass app.respond",
                "timedOut": false,
                "duration": 5,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n  this.respond = false;\n  var res = this.res;\n  res.statusCode = 200;\n  setImmediate(function(){\n    res.setHeader('Content-Type', 'text/plain');\n    res.end('lol');\n  })\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('lol')\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "d4757f82-922f-423b-9d41-20e0a6b52b47",
                "parentUUID": "3b1616fc-ba5a-442d-a120-56ae802163dc",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 1,
            "totalPasses": 1,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 5,
            "rootEmpty": false
          },
          {
            "title": "when this.type === null",
            "suites": [],
            "tests": [
              {
                "title": "should not send Content-Type header",
                "fullTitle": "app.respond when this.type === null should not send Content-Type header",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n  this.type = null;\n});\nvar server = app.listen();\nrequest(server)\n  .get('/')\n  .expect(200)\n  .end(function(err, res){\n    if (err) return done(err);\n    res.should.not.have.header('content-type');\n    done();\n  });",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:259:21)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "ccf23d22-a600-4811-b314-92ca7556169d",
                "parentUUID": "23a00d81-2f84-437a-826c-57438095502a",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "23a00d81-2f84-437a-826c-57438095502a",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [],
            "failures": [
              {
                "title": "should not send Content-Type header",
                "fullTitle": "app.respond when this.type === null should not send Content-Type header",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n  this.type = null;\n});\nvar server = app.listen();\nrequest(server)\n  .get('/')\n  .expect(200)\n  .end(function(err, res){\n    if (err) return done(err);\n    res.should.not.have.header('content-type');\n    done();\n  });",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:259:21)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "ccf23d22-a600-4811-b314-92ca7556169d",
                "parentUUID": "23a00d81-2f84-437a-826c-57438095502a",
                "isHook": false,
                "skipped": false
              }
            ],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 1,
            "totalPasses": 0,
            "totalFailures": 1,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": false,
            "hasFailures": true,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 0,
            "rootEmpty": false
          },
          {
            "title": "when HEAD is used",
            "suites": [],
            "tests": [
              {
                "title": "should not respond with the body",
                "fullTitle": "app.respond when HEAD is used should not respond with the body",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '5');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:280:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "bb622080-4d63-41a1-ab8c-8b4b08159a36",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep json headers",
                "fullTitle": "app.respond when HEAD is used should keep json headers",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/json; charset=utf-8');\n  res.should.have.header('Content-Length', '17');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:301:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "3925ce76-d623-4aa5-959d-fa570174ad3a",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep string headers",
                "fullTitle": "app.respond when HEAD is used should keep string headers",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello world';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:322:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "8f285de3-8c37-4264-be1c-b8a01df76d10",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep buffer headers",
                "fullTitle": "app.respond when HEAD is used should keep buffer headers",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('hello world');\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/octet-stream');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:343:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "dba5488f-3190-4f5e-8f36-d78d7083f058",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond with a 404 if no body was set",
                "fullTitle": "app.respond when HEAD is used should respond with a 404 if no body was set",
                "timedOut": false,
                "duration": 1,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(404, done);",
                "err": {},
                "isRoot": false,
                "uuid": "6ef1bf0b-8867-40dc-bfa4-235ad1edf12d",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond with a 200 if body = \"\"",
                "fullTitle": "app.respond when HEAD is used should respond with a 200 if body = \"\"",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200, done);",
                "err": {},
                "isRoot": false,
                "uuid": "f3f7f9fb-97bf-4c37-aecc-19205fd3026f",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should not overwrite the content-type",
                "fullTitle": "app.respond when HEAD is used should not overwrite the content-type",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.type = 'application/javascript';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect('content-type', /application\\/javascript/)\n.expect(200, done);",
                "err": {},
                "isRoot": false,
                "uuid": "3bf1473b-b0bc-4dac-aa51-d0ad0b398cd1",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should respond with a 404 if no body was set",
                "fullTitle": "app.respond when HEAD is used should respond with a 404 if no body was set",
                "timedOut": false,
                "duration": 1,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(404, done);",
                "err": {},
                "isRoot": false,
                "uuid": "6ef1bf0b-8867-40dc-bfa4-235ad1edf12d",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond with a 200 if body = \"\"",
                "fullTitle": "app.respond when HEAD is used should respond with a 200 if body = \"\"",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200, done);",
                "err": {},
                "isRoot": false,
                "uuid": "f3f7f9fb-97bf-4c37-aecc-19205fd3026f",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should not overwrite the content-type",
                "fullTitle": "app.respond when HEAD is used should not overwrite the content-type",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.type = 'application/javascript';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect('content-type', /application\\/javascript/)\n.expect(200, done);",
                "err": {},
                "isRoot": false,
                "uuid": "3bf1473b-b0bc-4dac-aa51-d0ad0b398cd1",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [
              {
                "title": "should not respond with the body",
                "fullTitle": "app.respond when HEAD is used should not respond with the body",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '5');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:280:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "bb622080-4d63-41a1-ab8c-8b4b08159a36",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep json headers",
                "fullTitle": "app.respond when HEAD is used should keep json headers",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/json; charset=utf-8');\n  res.should.have.header('Content-Length', '17');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:301:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "3925ce76-d623-4aa5-959d-fa570174ad3a",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep string headers",
                "fullTitle": "app.respond when HEAD is used should keep string headers",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello world';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:322:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "8f285de3-8c37-4264-be1c-b8a01df76d10",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep buffer headers",
                "fullTitle": "app.respond when HEAD is used should keep buffer headers",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('hello world');\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/octet-stream');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:343:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "dba5488f-3190-4f5e-8f36-d78d7083f058",
                "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
                "isHook": false,
                "skipped": false
              }
            ],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 7,
            "totalPasses": 3,
            "totalFailures": 4,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": true,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 6,
            "rootEmpty": false
          },
          {
            "title": "when no middleware are present",
            "suites": [],
            "tests": [
              {
                "title": "should 404",
                "fullTitle": "app.respond when no middleware are present should 404",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
                "err": {},
                "isRoot": false,
                "uuid": "94d88e17-d802-4088-b956-635e5f49be12",
                "parentUUID": "921e832d-9a06-43ba-8488-8672b93ec7a4",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "921e832d-9a06-43ba-8488-8672b93ec7a4",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should 404",
                "fullTitle": "app.respond when no middleware are present should 404",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
                "err": {},
                "isRoot": false,
                "uuid": "94d88e17-d802-4088-b956-635e5f49be12",
                "parentUUID": "921e832d-9a06-43ba-8488-8672b93ec7a4",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 1,
            "totalPasses": 1,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 2,
            "rootEmpty": false
          },
          {
            "title": "when res has already been written to",
            "suites": [],
            "tests": [
              {
                "title": "should not cause an app error",
                "fullTitle": "app.respond when res has already been written to should not cause an app error",
                "timedOut": false,
                "duration": 4,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\")\n  }, 0);\n});\nvar errorCaught = false;\napp.on('error', function(err){\n  errorCaught = err;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  if (errorCaught) return done(errorCaught);\n  done();\n});",
                "err": {},
                "isRoot": false,
                "uuid": "b6da8b84-d370-4475-84e6-9cddc36c57ee",
                "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should send the right body",
                "fullTitle": "app.respond when res has already been written to should send the right body",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\");\n  }, 0);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('HelloGoodbye', done);",
                "err": {},
                "isRoot": false,
                "uuid": "7d6da28f-bc95-418c-b29d-6c2dc8dad747",
                "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should not cause an app error",
                "fullTitle": "app.respond when res has already been written to should not cause an app error",
                "timedOut": false,
                "duration": 4,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\")\n  }, 0);\n});\nvar errorCaught = false;\napp.on('error', function(err){\n  errorCaught = err;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  if (errorCaught) return done(errorCaught);\n  done();\n});",
                "err": {},
                "isRoot": false,
                "uuid": "b6da8b84-d370-4475-84e6-9cddc36c57ee",
                "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should send the right body",
                "fullTitle": "app.respond when res has already been written to should send the right body",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\");\n  }, 0);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('HelloGoodbye', done);",
                "err": {},
                "isRoot": false,
                "uuid": "7d6da28f-bc95-418c-b29d-6c2dc8dad747",
                "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 2,
            "totalPasses": 2,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 6,
            "rootEmpty": false
          },
          {
            "title": "when .body is missing",
            "suites": [
              {
                "title": "with status=400",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond with the associated status message",
                    "fullTitle": "when .body is missing with status=400 should respond with the associated status message",
                    "timedOut": false,
                    "duration": 2,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 400;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(400)\n.expect('Content-Length', 11)\n.expect('Bad Request', done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "0c9b02ab-8946-4bfe-930d-4603bab209d7",
                    "parentUUID": "6925725c-45d6-42e2-9a52-3c248ad805d8",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "6925725c-45d6-42e2-9a52-3c248ad805d8",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [
                  {
                    "title": "should respond with the associated status message",
                    "fullTitle": "when .body is missing with status=400 should respond with the associated status message",
                    "timedOut": false,
                    "duration": 2,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 400;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(400)\n.expect('Content-Length', 11)\n.expect('Bad Request', done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "0c9b02ab-8946-4bfe-930d-4603bab209d7",
                    "parentUUID": "6925725c-45d6-42e2-9a52-3c248ad805d8",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "failures": [],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 1,
                "totalFailures": 0,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": true,
                "hasFailures": false,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 2,
                "rootEmpty": false
              },
              {
                "title": "with status=204",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond without a body",
                    "fullTitle": "when .body is missing with status=204 should respond without a body",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'not' of undefined",
                      "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:497:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "7b05533d-7565-4c3c-aa62-f5d7909327d5",
                    "parentUUID": "dd9f8e31-a5c0-478b-adee-fda9f25ef136",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "dd9f8e31-a5c0-478b-adee-fda9f25ef136",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [],
                "failures": [
                  {
                    "title": "should respond without a body",
                    "fullTitle": "when .body is missing with status=204 should respond without a body",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'not' of undefined",
                      "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:497:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "7b05533d-7565-4c3c-aa62-f5d7909327d5",
                    "parentUUID": "dd9f8e31-a5c0-478b-adee-fda9f25ef136",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 0,
                "totalFailures": 1,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": false,
                "hasFailures": true,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 0,
                "rootEmpty": false
              },
              {
                "title": "with status=205",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond without a body",
                    "fullTitle": "when .body is missing with status=205 should respond without a body",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'not' of undefined",
                      "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:520:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "e87e9832-d786-46da-a15b-466e0abefe27",
                    "parentUUID": "71adb34d-5a70-4749-a456-3c5ea7b73829",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "71adb34d-5a70-4749-a456-3c5ea7b73829",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [],
                "failures": [
                  {
                    "title": "should respond without a body",
                    "fullTitle": "when .body is missing with status=205 should respond without a body",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'not' of undefined",
                      "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:520:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "e87e9832-d786-46da-a15b-466e0abefe27",
                    "parentUUID": "71adb34d-5a70-4749-a456-3c5ea7b73829",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 0,
                "totalFailures": 1,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": false,
                "hasFailures": true,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 0,
                "rootEmpty": false
              },
              {
                "title": "with status=304",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond without a body",
                    "fullTitle": "when .body is missing with status=304 should respond without a body",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'not' of undefined",
                      "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:543:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "71c6bbea-6258-48b5-875b-c0f2c200cbb4",
                    "parentUUID": "58c6ba24-57cf-4b09-8342-d5724b82f915",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "58c6ba24-57cf-4b09-8342-d5724b82f915",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [],
                "failures": [
                  {
                    "title": "should respond without a body",
                    "fullTitle": "when .body is missing with status=304 should respond without a body",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'not' of undefined",
                      "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:543:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "71c6bbea-6258-48b5-875b-c0f2c200cbb4",
                    "parentUUID": "58c6ba24-57cf-4b09-8342-d5724b82f915",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 0,
                "totalFailures": 1,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": false,
                "hasFailures": true,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 0,
                "rootEmpty": false
              },
              {
                "title": "with custom status=700",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond with the associated status message",
                    "fullTitle": "when .body is missing with custom status=700 should respond with the associated status message",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\nstatuses['700'] = 'custom status';\napp.use(function *(){\n  this.status = 700;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(700)\n.expect('custom status')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('custom status');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'equal' of undefined",
                      "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:566:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "e5c9fd56-ad41-49f2-aff2-23f8a8411fa6",
                    "parentUUID": "416b1609-f46a-4b50-8db7-0497cc2a6304",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "416b1609-f46a-4b50-8db7-0497cc2a6304",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [],
                "failures": [
                  {
                    "title": "should respond with the associated status message",
                    "fullTitle": "when .body is missing with custom status=700 should respond with the associated status message",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\nstatuses['700'] = 'custom status';\napp.use(function *(){\n  this.status = 700;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(700)\n.expect('custom status')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('custom status');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'equal' of undefined",
                      "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:566:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "e5c9fd56-ad41-49f2-aff2-23f8a8411fa6",
                    "parentUUID": "416b1609-f46a-4b50-8db7-0497cc2a6304",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 0,
                "totalFailures": 1,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": false,
                "hasFailures": true,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 0,
                "rootEmpty": false
              },
              {
                "title": "with custom statusMessage=ok",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond with the custom status message",
                    "fullTitle": "when .body is missing with custom statusMessage=ok should respond with the custom status message",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.message = 'ok';\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('ok')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('ok');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'equal' of undefined",
                      "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:589:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "29ab484f-8f19-491b-aac1-1fdcfdfd9559",
                    "parentUUID": "57bb4eb5-b05d-440a-a92d-a99a4f06d017",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "57bb4eb5-b05d-440a-a92d-a99a4f06d017",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [],
                "failures": [
                  {
                    "title": "should respond with the custom status message",
                    "fullTitle": "when .body is missing with custom statusMessage=ok should respond with the custom status message",
                    "timedOut": false,
                    "duration": 0,
                    "state": "failed",
                    "pass": false,
                    "fail": true,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.message = 'ok';\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('ok')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('ok');\n  done();\n})",
                    "err": {
                      "message": "TypeError: Cannot read property 'equal' of undefined",
                      "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:589:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                    },
                    "isRoot": false,
                    "uuid": "29ab484f-8f19-491b-aac1-1fdcfdfd9559",
                    "parentUUID": "57bb4eb5-b05d-440a-a92d-a99a4f06d017",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 0,
                "totalFailures": 1,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": false,
                "hasFailures": true,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 0,
                "rootEmpty": false
              },
              {
                "title": "with custom status without message",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond with the status code number",
                    "fullTitle": "when .body is missing with custom status without message should respond with the status code number",
                    "timedOut": false,
                    "duration": 2,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.res.statusCode = 701;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(701)\n.expect('701', done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "3114e1f2-b55e-4d61-a27b-680675c653b6",
                    "parentUUID": "3f7483f0-5dba-488d-8557-72936d3464d9",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "3f7483f0-5dba-488d-8557-72936d3464d9",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [
                  {
                    "title": "should respond with the status code number",
                    "fullTitle": "when .body is missing with custom status without message should respond with the status code number",
                    "timedOut": false,
                    "duration": 2,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  this.res.statusCode = 701;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(701)\n.expect('701', done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "3114e1f2-b55e-4d61-a27b-680675c653b6",
                    "parentUUID": "3f7483f0-5dba-488d-8557-72936d3464d9",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "failures": [],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 1,
                "totalFailures": 0,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": true,
                "hasFailures": false,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 2,
                "rootEmpty": false
              }
            ],
            "tests": [],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "6e4ee13c-38f8-4434-90f5-47b0f7c3d70a",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": false,
            "hasSuites": true,
            "totalTests": 0,
            "totalPasses": 0,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": false,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 0,
            "rootEmpty": false
          },
          {
            "title": "when .body is a null",
            "suites": [],
            "tests": [
              {
                "title": "should respond 204 by default",
                "fullTitle": "app.respond when .body is a null should respond 204 by default",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:630:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "b7402624-ec75-441b-ad31-d1e9159e7014",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond 204 with status=200",
                "fullTitle": "app.respond when .body is a null should respond 204 with status=200",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:652:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "39c70370-d62b-4dbc-89d6-952cc9c01731",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond 205 with status=205",
                "fullTitle": "app.respond when .body is a null should respond 205 with status=205",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:674:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "3d5d0271-e30d-4c5f-92cd-033021b7919e",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond 304 with status=304",
                "fullTitle": "app.respond when .body is a null should respond 304 with status=304",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:696:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "875a0ba6-7cd8-4294-929a-5aea9f204049",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "72398050-29e3-42cb-bcf5-bb4442d2248c",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [],
            "failures": [
              {
                "title": "should respond 204 by default",
                "fullTitle": "app.respond when .body is a null should respond 204 by default",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:630:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "b7402624-ec75-441b-ad31-d1e9159e7014",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond 204 with status=200",
                "fullTitle": "app.respond when .body is a null should respond 204 with status=200",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:652:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "39c70370-d62b-4dbc-89d6-952cc9c01731",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond 205 with status=205",
                "fullTitle": "app.respond when .body is a null should respond 205 with status=205",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:674:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "3d5d0271-e30d-4c5f-92cd-033021b7919e",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond 304 with status=304",
                "fullTitle": "app.respond when .body is a null should respond 304 with status=304",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:696:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "875a0ba6-7cd8-4294-929a-5aea9f204049",
                "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
                "isHook": false,
                "skipped": false
              }
            ],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 4,
            "totalPasses": 0,
            "totalFailures": 4,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": false,
            "hasFailures": true,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 0,
            "rootEmpty": false
          },
          {
            "title": "when .body is a string",
            "suites": [],
            "tests": [
              {
                "title": "should respond",
                "fullTitle": "app.respond when .body is a string should respond",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
                "err": {},
                "isRoot": false,
                "uuid": "bc9fa573-ae08-4316-9eff-e1ebe2fc36a1",
                "parentUUID": "d8ecf142-2453-441f-9da0-22f40d6d64d1",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "d8ecf142-2453-441f-9da0-22f40d6d64d1",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should respond",
                "fullTitle": "app.respond when .body is a string should respond",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
                "err": {},
                "isRoot": false,
                "uuid": "bc9fa573-ae08-4316-9eff-e1ebe2fc36a1",
                "parentUUID": "d8ecf142-2453-441f-9da0-22f40d6d64d1",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 1,
            "totalPasses": 1,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 2,
            "rootEmpty": false
          },
          {
            "title": "when .body is a Buffer",
            "suites": [],
            "tests": [
              {
                "title": "should respond",
                "fullTitle": "app.respond when .body is a Buffer should respond",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('Hello');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
                "err": {},
                "isRoot": false,
                "uuid": "a40214c7-e8ac-416e-a48c-60b9457dfc65",
                "parentUUID": "b167cf4c-8c81-4223-877a-d6835f67277e",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "b167cf4c-8c81-4223-877a-d6835f67277e",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should respond",
                "fullTitle": "app.respond when .body is a Buffer should respond",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('Hello');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
                "err": {},
                "isRoot": false,
                "uuid": "a40214c7-e8ac-416e-a48c-60b9457dfc65",
                "parentUUID": "b167cf4c-8c81-4223-877a-d6835f67277e",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 1,
            "totalPasses": 1,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 3,
            "rootEmpty": false
          },
          {
            "title": "when .body is a Stream",
            "suites": [],
            "tests": [
              {
                "title": "should respond",
                "fullTitle": "app.respond when .body is a Stream should respond",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:751:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "30982b89-8d6b-46a5-9c76-70514fa0f427",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should strip content-length when overwriting",
                "fullTitle": "app.respond when .body is a Stream should strip content-length when overwriting",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello';\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:774:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "f49ef151-c121-4540-969d-40e089d51e4e",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep content-length if not overwritten",
                "fullTitle": "app.respond when .body is a Stream should keep content-length if not overwritten",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:797:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "c36dd382-6b77-4f58-b8bd-bbbdf0d8d23c",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep content-length if overwritten with the same stream",
                "fullTitle": "app.respond when .body is a Stream should keep content-length if overwritten with the same stream",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  var stream = fs.createReadStream('package.json');\n  this.body = stream;\n  this.body = stream;\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:822:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "554dc374-7b31-497b-b447-e4284ad1d443",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should handle errors",
                "fullTitle": "app.respond when .body is a Stream should handle errors",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.set('Content-Type', 'application/json; charset=utf-8');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'text/plain; charset=utf-8')\n.expect(404)\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "7c11b6d7-446c-4286-b4dd-4dbce902a29f",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should handle errors when no content status",
                "fullTitle": "app.respond when .body is a Stream should handle errors when no content status",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204, done);",
                "err": {},
                "isRoot": false,
                "uuid": "f18f05d1-e599-4054-bd98-49829c018941",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should handle all intermediate stream body errors",
                "fullTitle": "app.respond when .body is a Stream should handle all intermediate stream body errors",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
                "err": {},
                "isRoot": false,
                "uuid": "1eca3a5d-4713-4b21-ba8f-73e9000c8bc8",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should handle errors",
                "fullTitle": "app.respond when .body is a Stream should handle errors",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.set('Content-Type', 'application/json; charset=utf-8');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'text/plain; charset=utf-8')\n.expect(404)\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "7c11b6d7-446c-4286-b4dd-4dbce902a29f",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should handle errors when no content status",
                "fullTitle": "app.respond when .body is a Stream should handle errors when no content status",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204, done);",
                "err": {},
                "isRoot": false,
                "uuid": "f18f05d1-e599-4054-bd98-49829c018941",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should handle all intermediate stream body errors",
                "fullTitle": "app.respond when .body is a Stream should handle all intermediate stream body errors",
                "timedOut": false,
                "duration": 3,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
                "err": {},
                "isRoot": false,
                "uuid": "1eca3a5d-4713-4b21-ba8f-73e9000c8bc8",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [
              {
                "title": "should respond",
                "fullTitle": "app.respond when .body is a Stream should respond",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:751:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "30982b89-8d6b-46a5-9c76-70514fa0f427",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should strip content-length when overwriting",
                "fullTitle": "app.respond when .body is a Stream should strip content-length when overwriting",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello';\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:774:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "f49ef151-c121-4540-969d-40e089d51e4e",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep content-length if not overwritten",
                "fullTitle": "app.respond when .body is a Stream should keep content-length if not overwritten",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:797:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "c36dd382-6b77-4f58-b8bd-bbbdf0d8d23c",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should keep content-length if overwritten with the same stream",
                "fullTitle": "app.respond when .body is a Stream should keep content-length if overwritten with the same stream",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  var stream = fs.createReadStream('package.json');\n  this.body = stream;\n  this.body = stream;\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
                "err": {
                  "message": "TypeError: Cannot read property 'have' of undefined",
                  "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:822:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "554dc374-7b31-497b-b447-e4284ad1d443",
                "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
                "isHook": false,
                "skipped": false
              }
            ],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 7,
            "totalPasses": 3,
            "totalFailures": 4,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": true,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 8,
            "rootEmpty": false
          },
          {
            "title": "when .body is an Object",
            "suites": [],
            "tests": [
              {
                "title": "should respond with json",
                "fullTitle": "app.respond when .body is an Object should respond with json",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.expect('{\"hello\":\"world\"}', done);",
                "err": {},
                "isRoot": false,
                "uuid": "fa66a76c-884d-4a60-94a0-4dc6cf076331",
                "parentUUID": "63e86dab-3dd9-4d1e-9290-d85e7e08aa74",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "63e86dab-3dd9-4d1e-9290-d85e7e08aa74",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should respond with json",
                "fullTitle": "app.respond when .body is an Object should respond with json",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.expect('{\"hello\":\"world\"}', done);",
                "err": {},
                "isRoot": false,
                "uuid": "fa66a76c-884d-4a60-94a0-4dc6cf076331",
                "parentUUID": "63e86dab-3dd9-4d1e-9290-d85e7e08aa74",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 1,
            "totalPasses": 1,
            "totalFailures": 0,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": false,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 2,
            "rootEmpty": false
          },
          {
            "title": "when an error occurs",
            "suites": [
              {
                "title": "with an .expose property",
                "suites": [],
                "tests": [
                  {
                    "title": "should expose the message",
                    "fullTitle": "when an error occurs with an .expose property should expose the message",
                    "timedOut": false,
                    "duration": 4,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('sorry!');\n  err.status = 403;\n  err.expose = true;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'sorry!')\n.end(done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "628a8677-b38d-4d03-8247-e7c05fc51f60",
                    "parentUUID": "e06ac847-ddd4-4f7e-9fa7-101f833d03d1",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "e06ac847-ddd4-4f7e-9fa7-101f833d03d1",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [
                  {
                    "title": "should expose the message",
                    "fullTitle": "when an error occurs with an .expose property should expose the message",
                    "timedOut": false,
                    "duration": 4,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('sorry!');\n  err.status = 403;\n  err.expose = true;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'sorry!')\n.end(done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "628a8677-b38d-4d03-8247-e7c05fc51f60",
                    "parentUUID": "e06ac847-ddd4-4f7e-9fa7-101f833d03d1",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "failures": [],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 1,
                "totalFailures": 0,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": true,
                "hasFailures": false,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 4,
                "rootEmpty": false
              },
              {
                "title": "with a .status property",
                "suites": [],
                "tests": [
                  {
                    "title": "should respond with .status",
                    "fullTitle": "when an error occurs with a .status property should respond with .status",
                    "timedOut": false,
                    "duration": 2,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('s3 explodes');\n  err.status = 403;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'Forbidden')\n.end(done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "2b970da1-6116-49d5-866b-a9f0822ce543",
                    "parentUUID": "cf907981-c525-4d73-ba02-c5ccf07016a6",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "pending": [],
                "root": false,
                "_timeout": 2000,
                "file": "/test/application.js",
                "uuid": "cf907981-c525-4d73-ba02-c5ccf07016a6",
                "beforeHooks": [],
                "afterHooks": [],
                "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
                "passes": [
                  {
                    "title": "should respond with .status",
                    "fullTitle": "when an error occurs with a .status property should respond with .status",
                    "timedOut": false,
                    "duration": 2,
                    "state": "passed",
                    "speed": "fast",
                    "pass": true,
                    "fail": false,
                    "pending": false,
                    "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('s3 explodes');\n  err.status = 403;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'Forbidden')\n.end(done);",
                    "err": {},
                    "isRoot": false,
                    "uuid": "2b970da1-6116-49d5-866b-a9f0822ce543",
                    "parentUUID": "cf907981-c525-4d73-ba02-c5ccf07016a6",
                    "isHook": false,
                    "skipped": false
                  }
                ],
                "failures": [],
                "skipped": [],
                "hasBeforeHooks": false,
                "hasAfterHooks": false,
                "hasTests": true,
                "hasSuites": false,
                "totalTests": 1,
                "totalPasses": 1,
                "totalFailures": 0,
                "totalPending": 0,
                "totalSkipped": 0,
                "hasPasses": true,
                "hasFailures": false,
                "hasPending": false,
                "hasSkipped": false,
                "duration": 2,
                "rootEmpty": false
              }
            ],
            "tests": [
              {
                "title": "should emit \"error\" on the app",
                "fullTitle": "app.respond when an error occurs should emit \"error\" on the app",
                "timedOut": true,
                "duration": 2001,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom');\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
                "err": {
                  "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
                  "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
                },
                "isRoot": false,
                "uuid": "e3c7559e-c924-4f74-8aa7-426c01f5adf1",
                "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should respond with 500",
                "fullTitle": "app.respond when an error occurs should respond with 500",
                "timedOut": false,
                "duration": 4,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom!');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(500, 'Internal Server Error')\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "5c7137ac-a4dd-4186-8344-1892f527b14c",
                "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should be catchable",
                "fullTitle": "app.respond when an error occurs should be catchable",
                "timedOut": false,
                "duration": 12,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(next){\n  try {\n    yield next;\n    this.body = 'Hello';\n  } catch (err) {\n    this.body = 'Got error';\n  }\n});\napp.use(function *(next){\n  throw new Error('boom!');\n  this.body = 'Oh no';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200, 'Got error')\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "17662c54-c393-4d26-be63-098c46d62661",
                "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "41f2c022-75a1-4028-bd45-800ca80631a2",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should respond with 500",
                "fullTitle": "app.respond when an error occurs should respond with 500",
                "timedOut": false,
                "duration": 4,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom!');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(500, 'Internal Server Error')\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "5c7137ac-a4dd-4186-8344-1892f527b14c",
                "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should be catchable",
                "fullTitle": "app.respond when an error occurs should be catchable",
                "timedOut": false,
                "duration": 12,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(next){\n  try {\n    yield next;\n    this.body = 'Hello';\n  } catch (err) {\n    this.body = 'Got error';\n  }\n});\napp.use(function *(next){\n  throw new Error('boom!');\n  this.body = 'Oh no';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200, 'Got error')\n.end(done);",
                "err": {},
                "isRoot": false,
                "uuid": "17662c54-c393-4d26-be63-098c46d62661",
                "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [
              {
                "title": "should emit \"error\" on the app",
                "fullTitle": "app.respond when an error occurs should emit \"error\" on the app",
                "timedOut": true,
                "duration": 2001,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom');\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
                "err": {
                  "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
                  "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
                },
                "isRoot": false,
                "uuid": "e3c7559e-c924-4f74-8aa7-426c01f5adf1",
                "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
                "isHook": false,
                "skipped": false
              }
            ],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": true,
            "totalTests": 3,
            "totalPasses": 2,
            "totalFailures": 1,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": true,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 2017,
            "rootEmpty": false
          },
          {
            "title": "when status and body property",
            "suites": [],
            "tests": [
              {
                "title": "should 200",
                "fullTitle": "app.respond when status and body property should 200",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = 'hello';\n  this.status = 200;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('hello', done);",
                "err": {},
                "isRoot": false,
                "uuid": "31e46d3f-26db-4a13-b376-861ccd7152a7",
                "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
                "isHook": false,
                "skipped": false
              },
              {
                "title": "should 204",
                "fullTitle": "app.respond when status and body property should 204",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = 'hello';\n  this.set('content-type', 'text/plain; charset=utf8');\n  this.status = 204;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.end(function (err, res) {\n  res.should.not.have.header('content-type');\n  done(err);\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:1023:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "d88d16e7-f810-49c4-8c75-926cca4f02e7",
                "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
                "isHook": false,
                "skipped": false
              }
            ],
            "pending": [],
            "root": false,
            "_timeout": 2000,
            "file": "/test/application.js",
            "uuid": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
            "beforeHooks": [],
            "afterHooks": [],
            "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
            "passes": [
              {
                "title": "should 200",
                "fullTitle": "app.respond when status and body property should 200",
                "timedOut": false,
                "duration": 2,
                "state": "passed",
                "speed": "fast",
                "pass": true,
                "fail": false,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = 'hello';\n  this.status = 200;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('hello', done);",
                "err": {},
                "isRoot": false,
                "uuid": "31e46d3f-26db-4a13-b376-861ccd7152a7",
                "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
                "isHook": false,
                "skipped": false
              }
            ],
            "failures": [
              {
                "title": "should 204",
                "fullTitle": "app.respond when status and body property should 204",
                "timedOut": false,
                "duration": 0,
                "state": "failed",
                "pass": false,
                "fail": true,
                "pending": false,
                "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = 'hello';\n  this.set('content-type', 'text/plain; charset=utf8');\n  this.status = 204;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.end(function (err, res) {\n  res.should.not.have.header('content-type');\n  done(err);\n});",
                "err": {
                  "message": "TypeError: Cannot read property 'not' of undefined",
                  "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:1023:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
                },
                "isRoot": false,
                "uuid": "d88d16e7-f810-49c4-8c75-926cca4f02e7",
                "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
                "isHook": false,
                "skipped": false
              }
            ],
            "skipped": [],
            "hasBeforeHooks": false,
            "hasAfterHooks": false,
            "hasTests": true,
            "hasSuites": false,
            "totalTests": 2,
            "totalPasses": 1,
            "totalFailures": 1,
            "totalPending": 0,
            "totalSkipped": 0,
            "hasPasses": true,
            "hasFailures": true,
            "hasPending": false,
            "hasSkipped": false,
            "duration": 2,
            "rootEmpty": false
          }
        ],
        "tests": [],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "0bcdf227-cc10-48bd-8482-cda5f74573a5",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [],
        "failures": [],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": false,
        "hasSuites": true,
        "totalTests": 0,
        "totalPasses": 0,
        "totalFailures": 0,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": false,
        "hasFailures": false,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 0,
        "rootEmpty": false
      },
      {
        "title": "app.context",
        "suites": [],
        "tests": [
          {
            "title": "should merge properties",
            "fullTitle": "app.context should merge properties",
            "timedOut": false,
            "duration": 1,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app1.use(function *(next){\n  assert.equal(this.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "ccd25cd5-c4c2-4e90-ad8a-4e62e5cf2d9e",
            "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not affect the original prototype",
            "fullTitle": "app.context should not affect the original prototype",
            "timedOut": false,
            "duration": 1,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app2.use(function *(next){\n  assert.equal(this.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "bece6085-4d02-4359-ac04-23e27fd76778",
            "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [
          {
            "title": "should merge properties",
            "fullTitle": "app.context should merge properties",
            "timedOut": false,
            "duration": 1,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app1.use(function *(next){\n  assert.equal(this.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "ccd25cd5-c4c2-4e90-ad8a-4e62e5cf2d9e",
            "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not affect the original prototype",
            "fullTitle": "app.context should not affect the original prototype",
            "timedOut": false,
            "duration": 1,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app2.use(function *(next){\n  assert.equal(this.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "bece6085-4d02-4359-ac04-23e27fd76778",
            "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
            "isHook": false,
            "skipped": false
          }
        ],
        "failures": [],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 2,
        "totalPasses": 2,
        "totalFailures": 0,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": true,
        "hasFailures": false,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 2,
        "rootEmpty": false
      },
      {
        "title": "app.request",
        "suites": [],
        "tests": [
          {
            "title": "should merge properties",
            "fullTitle": "app.request should merge properties",
            "timedOut": false,
            "duration": 2,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app1.use(function *(next){\n  assert.equal(this.request.message, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "d4a3c6cb-6672-4a9a-bea1-690a1592b6cb",
            "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not affect the original prototype",
            "fullTitle": "app.request should not affect the original prototype",
            "timedOut": false,
            "duration": 2,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app2.use(function *(next){\n  assert.equal(this.request.message, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "9a139b34-fb86-4110-aac6-7b47a266884f",
            "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "a16a3817-0938-4790-865d-7a521f5b6811",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [
          {
            "title": "should merge properties",
            "fullTitle": "app.request should merge properties",
            "timedOut": false,
            "duration": 2,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app1.use(function *(next){\n  assert.equal(this.request.message, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "d4a3c6cb-6672-4a9a-bea1-690a1592b6cb",
            "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not affect the original prototype",
            "fullTitle": "app.request should not affect the original prototype",
            "timedOut": false,
            "duration": 2,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app2.use(function *(next){\n  assert.equal(this.request.message, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "9a139b34-fb86-4110-aac6-7b47a266884f",
            "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
            "isHook": false,
            "skipped": false
          }
        ],
        "failures": [],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 2,
        "totalPasses": 2,
        "totalFailures": 0,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": true,
        "hasFailures": false,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 4,
        "rootEmpty": false
      },
      {
        "title": "app.response",
        "suites": [],
        "tests": [
          {
            "title": "should merge properties",
            "fullTitle": "app.response should merge properties",
            "timedOut": false,
            "duration": 2,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app1.use(function *(next){\n  assert.equal(this.response.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "64bd6b1e-cfd7-40ea-b75b-a73ebf00f483",
            "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not affect the original prototype",
            "fullTitle": "app.response should not affect the original prototype",
            "timedOut": false,
            "duration": 1,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app2.use(function *(next){\n  assert.equal(this.response.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "fc37ec66-7664-453d-b69c-7ccff3d23ae5",
            "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
            "isHook": false,
            "skipped": false
          }
        ],
        "pending": [],
        "root": false,
        "_timeout": 2000,
        "file": "/test/application.js",
        "uuid": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
        "beforeHooks": [],
        "afterHooks": [],
        "fullFile": "/Users/wuhao/DP_H5_work/koa/koa1/test/application.js",
        "passes": [
          {
            "title": "should merge properties",
            "fullTitle": "app.response should merge properties",
            "timedOut": false,
            "duration": 2,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app1.use(function *(next){\n  assert.equal(this.response.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "64bd6b1e-cfd7-40ea-b75b-a73ebf00f483",
            "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
            "isHook": false,
            "skipped": false
          },
          {
            "title": "should not affect the original prototype",
            "fullTitle": "app.response should not affect the original prototype",
            "timedOut": false,
            "duration": 1,
            "state": "passed",
            "speed": "fast",
            "pass": true,
            "fail": false,
            "pending": false,
            "code": "app2.use(function *(next){\n  assert.equal(this.response.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
            "err": {},
            "isRoot": false,
            "uuid": "fc37ec66-7664-453d-b69c-7ccff3d23ae5",
            "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
            "isHook": false,
            "skipped": false
          }
        ],
        "failures": [],
        "skipped": [],
        "hasBeforeHooks": false,
        "hasAfterHooks": false,
        "hasTests": true,
        "hasSuites": false,
        "totalTests": 2,
        "totalPasses": 2,
        "totalFailures": 0,
        "totalPending": 0,
        "totalSkipped": 0,
        "hasPasses": true,
        "hasFailures": false,
        "hasPending": false,
        "hasSkipped": false,
        "duration": 3,
        "rootEmpty": false
      }
    ],
    "tests": [],
    "pending": [],
    "root": true,
    "_timeout": 2000,
    "uuid": "19b77cb4-b575-4f8f-bbcc-7f9acca6c826",
    "beforeHooks": [],
    "afterHooks": [],
    "fullFile": "",
    "file": "",
    "passes": [],
    "failures": [],
    "skipped": [],
    "hasBeforeHooks": false,
    "hasAfterHooks": false,
    "hasTests": false,
    "hasSuites": true,
    "totalTests": 0,
    "totalPasses": 0,
    "totalFailures": 0,
    "totalPending": 0,
    "totalSkipped": 0,
    "hasPasses": false,
    "hasFailures": false,
    "hasPending": false,
    "hasSkipped": false,
    "duration": 0,
    "rootEmpty": true
  },
  "allTests": [
    {
      "title": "should handle socket errors",
      "fullTitle": "app should handle socket errors",
      "timedOut": true,
      "duration": 2007,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  // triggers this.socket.writable == false\n  this.socket.emit('error', new Error('boom'));\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
      "err": {
        "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
        "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
      },
      "isRoot": false,
      "uuid": "641c0b23-c5ca-4d08-b4fc-f980769e69a1",
      "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not .writeHead when !socket.writable",
      "fullTitle": "app should not .writeHead when !socket.writable",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  // set .writable to false\n  this.socket.writable = false;\n  this.status = 204;\n  // throw if .writeHead or .end is called\n  this.res.writeHead =\n  this.res.end = function(){\n    throw new Error('response sent');\n  };\n})\n// hackish, but the response should occur in a single tick\nsetImmediate(done);\nrequest(app.listen())\n.get('/')\n.end(function(){});",
      "err": {},
      "isRoot": false,
      "uuid": "e4b08348-010b-484d-9600-22eac21434a0",
      "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should set development env when NODE_ENV missing",
      "fullTitle": "app should set development env when NODE_ENV missing",
      "timedOut": false,
      "duration": 0,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var NODE_ENV = process.env.NODE_ENV;\nprocess.env.NODE_ENV = '';\nvar app = koa();\nprocess.env.NODE_ENV = NODE_ENV;\nassert.equal(app.env, 'development');",
      "err": {},
      "isRoot": false,
      "uuid": "e964ad37-0db4-489f-bcd8-436713cbcf2c",
      "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should work",
      "fullTitle": "app.toJSON() should work",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar obj = app.toJSON();\nobj.should.eql({\n  subdomainOffset: 2,\n  proxy: false,\n  env: 'test'\n});",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:69:15)"
      },
      "isRoot": false,
      "uuid": "a28e7671-a15e-423a-9761-1ec60dec35c2",
      "parentUUID": "8b74cd26-5c31-4d9b-ba0d-6f4668b6e1a0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should work",
      "fullTitle": "app.inspect() should work",
      "timedOut": false,
      "duration": 3,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar util = require('util');\nvar str = util.inspect(app);\nassert.equal(\"{ subdomainOffset: 2, proxy: false, env: 'test' }\", str);",
      "err": {
        "message": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'",
        "estack": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'\n    at Context.<anonymous> (test/application.js:82:12)",
        "diff": "- { subdomainOffset: 2, proxy: false, env: 'test' }\n+ { subdomainOffset: 2, proxy: false, env: 'undefined' }\n"
      },
      "isRoot": false,
      "uuid": "a0d003d7-8d34-4ca1-823e-32626b3b20c6",
      "parentUUID": "73350234-abae-45dd-abb8-ca709c897710",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should compose middleware",
      "fullTitle": "app.use(fn) should compose middleware",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar calls = [];\napp.use(function *(next){\n  calls.push(1);\n  yield next;\n  calls.push(6);\n});\napp.use(function *(next){\n  calls.push(2);\n  yield next;\n  calls.push(5);\n});\napp.use(function *(next){\n  calls.push(3);\n  yield next;\n  calls.push(4);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404)\n.end(function(err){\n  if (err) return done(err);\n  calls.should.eql([1,2,3,4,5,6]);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Test.<anonymous> (test/application.js:116:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "8177e9bf-2589-412e-a46b-28d20c145fe2",
      "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should error when a non-generator function is passed",
      "fullTitle": "app.use(fn) should error when a non-generator function is passed",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\ntry {\n  app.use(function(){});\n} catch (err) {\n  err.message.should.equal('app.use() requires a generator function');\n}",
      "err": {
        "message": "TypeError: Cannot read property 'equal' of undefined",
        "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Context.<anonymous> (test/application.js:127:25)"
      },
      "isRoot": false,
      "uuid": "69805d01-fc25-433e-bde6-80ff8a3c3c4c",
      "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not error when a non-generator function is passed when .experimental=true",
      "fullTitle": "app.use(fn) should not error when a non-generator function is passed when .experimental=true",
      "timedOut": false,
      "duration": 0,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.experimental = true;\napp.use(function(){});",
      "err": {},
      "isRoot": false,
      "uuid": "5fa9b996-9292-45de-8bf2-6b059f006f36",
      "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should throw an error if a non-error is given",
      "fullTitle": "app.onerror(err) should throw an error if a non-error is given",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\ntry {\n  app.onerror('foo');\n  should.fail();\n} catch (err) {\n  err.should.be.instanceOf(AssertionError);\n  err.message.should.equal('non-error thrown: foo');\n}\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'be' of undefined",
        "estack": "TypeError: Cannot read property 'be' of undefined\n    at Context.<anonymous> (test/application.js:147:17)"
      },
      "isRoot": false,
      "uuid": "358fb66c-7786-4af2-b5b1-96f23f6a2f02",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should do nothing if status is 404",
      "fullTitle": "app.onerror(err) should do nothing if status is 404",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar err = new Error();\nerr.status = 404;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:164:18)"
      },
      "isRoot": false,
      "uuid": "fd7cbfdd-5741-4f08-94aa-396404120cd7",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should do nothing if .silent",
      "fullTitle": "app.onerror(err) should do nothing if .silent",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.silent = true;\nvar err = new Error();\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:178:18)"
      },
      "isRoot": false,
      "uuid": "0ddf2c30-9286-4d0b-a67d-5143b9dc0ac8",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should log the error to stderr",
      "fullTitle": "app.onerror(err) should log the error to stderr",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error();\nerr.stack = 'Foo';\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Foo\\n\", \"\\n\"]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:194:18)"
      },
      "isRoot": false,
      "uuid": "29e363fd-acdc-41e7-a1b3-ae26973e084b",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should use err.toString() instad of err.stack",
      "fullTitle": "app.onerror(err) should use err.toString() instad of err.stack",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error('mock stack null');\nerr.stack = null;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Error: mock stack null\\n\", \"\\n\"]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:210:18)"
      },
      "isRoot": false,
      "uuid": "d9915255-f6ab-458b-a2e4-abba6291c7d7",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should bypass app.respond",
      "fullTitle": "when this.respond === false should bypass app.respond",
      "timedOut": false,
      "duration": 5,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n  this.respond = false;\n  var res = this.res;\n  res.statusCode = 200;\n  setImmediate(function(){\n    res.setHeader('Content-Type', 'text/plain');\n    res.end('lol');\n  })\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('lol')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "d4757f82-922f-423b-9d41-20e0a6b52b47",
      "parentUUID": "3b1616fc-ba5a-442d-a120-56ae802163dc",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not send Content-Type header",
      "fullTitle": "when this.type === null should not send Content-Type header",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n  this.type = null;\n});\nvar server = app.listen();\nrequest(server)\n  .get('/')\n  .expect(200)\n  .end(function(err, res){\n    if (err) return done(err);\n    res.should.not.have.header('content-type');\n    done();\n  });",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:259:21)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "ccf23d22-a600-4811-b314-92ca7556169d",
      "parentUUID": "23a00d81-2f84-437a-826c-57438095502a",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not respond with the body",
      "fullTitle": "when HEAD is used should not respond with the body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '5');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:280:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "bb622080-4d63-41a1-ab8c-8b4b08159a36",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep json headers",
      "fullTitle": "when HEAD is used should keep json headers",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/json; charset=utf-8');\n  res.should.have.header('Content-Length', '17');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:301:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "3925ce76-d623-4aa5-959d-fa570174ad3a",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep string headers",
      "fullTitle": "when HEAD is used should keep string headers",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello world';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:322:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "8f285de3-8c37-4264-be1c-b8a01df76d10",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep buffer headers",
      "fullTitle": "when HEAD is used should keep buffer headers",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('hello world');\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/octet-stream');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:343:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "dba5488f-3190-4f5e-8f36-d78d7083f058",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with a 404 if no body was set",
      "fullTitle": "when HEAD is used should respond with a 404 if no body was set",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(404, done);",
      "err": {},
      "isRoot": false,
      "uuid": "6ef1bf0b-8867-40dc-bfa4-235ad1edf12d",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with a 200 if body = \"\"",
      "fullTitle": "when HEAD is used should respond with a 200 if body = \"\"",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200, done);",
      "err": {},
      "isRoot": false,
      "uuid": "f3f7f9fb-97bf-4c37-aecc-19205fd3026f",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not overwrite the content-type",
      "fullTitle": "when HEAD is used should not overwrite the content-type",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.type = 'application/javascript';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect('content-type', /application\\/javascript/)\n.expect(200, done);",
      "err": {},
      "isRoot": false,
      "uuid": "3bf1473b-b0bc-4dac-aa51-d0ad0b398cd1",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should 404",
      "fullTitle": "when no middleware are present should 404",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
      "err": {},
      "isRoot": false,
      "uuid": "94d88e17-d802-4088-b956-635e5f49be12",
      "parentUUID": "921e832d-9a06-43ba-8488-8672b93ec7a4",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not cause an app error",
      "fullTitle": "when res has already been written to should not cause an app error",
      "timedOut": false,
      "duration": 4,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\")\n  }, 0);\n});\nvar errorCaught = false;\napp.on('error', function(err){\n  errorCaught = err;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  if (errorCaught) return done(errorCaught);\n  done();\n});",
      "err": {},
      "isRoot": false,
      "uuid": "b6da8b84-d370-4475-84e6-9cddc36c57ee",
      "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should send the right body",
      "fullTitle": "when res has already been written to should send the right body",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\");\n  }, 0);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('HelloGoodbye', done);",
      "err": {},
      "isRoot": false,
      "uuid": "7d6da28f-bc95-418c-b29d-6c2dc8dad747",
      "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the associated status message",
      "fullTitle": "with status=400 should respond with the associated status message",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 400;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(400)\n.expect('Content-Length', 11)\n.expect('Bad Request', done);",
      "err": {},
      "isRoot": false,
      "uuid": "0c9b02ab-8946-4bfe-930d-4603bab209d7",
      "parentUUID": "6925725c-45d6-42e2-9a52-3c248ad805d8",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond without a body",
      "fullTitle": "with status=204 should respond without a body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:497:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "7b05533d-7565-4c3c-aa62-f5d7909327d5",
      "parentUUID": "dd9f8e31-a5c0-478b-adee-fda9f25ef136",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond without a body",
      "fullTitle": "with status=205 should respond without a body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:520:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "e87e9832-d786-46da-a15b-466e0abefe27",
      "parentUUID": "71adb34d-5a70-4749-a456-3c5ea7b73829",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond without a body",
      "fullTitle": "with status=304 should respond without a body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:543:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "71c6bbea-6258-48b5-875b-c0f2c200cbb4",
      "parentUUID": "58c6ba24-57cf-4b09-8342-d5724b82f915",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the associated status message",
      "fullTitle": "with custom status=700 should respond with the associated status message",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nstatuses['700'] = 'custom status';\napp.use(function *(){\n  this.status = 700;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(700)\n.expect('custom status')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('custom status');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'equal' of undefined",
        "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:566:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "e5c9fd56-ad41-49f2-aff2-23f8a8411fa6",
      "parentUUID": "416b1609-f46a-4b50-8db7-0497cc2a6304",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the custom status message",
      "fullTitle": "with custom statusMessage=ok should respond with the custom status message",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.message = 'ok';\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('ok')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('ok');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'equal' of undefined",
        "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:589:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "29ab484f-8f19-491b-aac1-1fdcfdfd9559",
      "parentUUID": "57bb4eb5-b05d-440a-a92d-a99a4f06d017",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the status code number",
      "fullTitle": "with custom status without message should respond with the status code number",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.res.statusCode = 701;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(701)\n.expect('701', done);",
      "err": {},
      "isRoot": false,
      "uuid": "3114e1f2-b55e-4d61-a27b-680675c653b6",
      "parentUUID": "3f7483f0-5dba-488d-8557-72936d3464d9",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 204 by default",
      "fullTitle": "when .body is a null should respond 204 by default",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:630:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "b7402624-ec75-441b-ad31-d1e9159e7014",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 204 with status=200",
      "fullTitle": "when .body is a null should respond 204 with status=200",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:652:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "39c70370-d62b-4dbc-89d6-952cc9c01731",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 205 with status=205",
      "fullTitle": "when .body is a null should respond 205 with status=205",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:674:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "3d5d0271-e30d-4c5f-92cd-033021b7919e",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 304 with status=304",
      "fullTitle": "when .body is a null should respond 304 with status=304",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:696:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "875a0ba6-7cd8-4294-929a-5aea9f204049",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond",
      "fullTitle": "when .body is a string should respond",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
      "err": {},
      "isRoot": false,
      "uuid": "bc9fa573-ae08-4316-9eff-e1ebe2fc36a1",
      "parentUUID": "d8ecf142-2453-441f-9da0-22f40d6d64d1",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond",
      "fullTitle": "when .body is a Buffer should respond",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('Hello');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
      "err": {},
      "isRoot": false,
      "uuid": "a40214c7-e8ac-416e-a48c-60b9457dfc65",
      "parentUUID": "b167cf4c-8c81-4223-877a-d6835f67277e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond",
      "fullTitle": "when .body is a Stream should respond",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:751:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "30982b89-8d6b-46a5-9c76-70514fa0f427",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should strip content-length when overwriting",
      "fullTitle": "when .body is a Stream should strip content-length when overwriting",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello';\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:774:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "f49ef151-c121-4540-969d-40e089d51e4e",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep content-length if not overwritten",
      "fullTitle": "when .body is a Stream should keep content-length if not overwritten",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:797:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "c36dd382-6b77-4f58-b8bd-bbbdf0d8d23c",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep content-length if overwritten with the same stream",
      "fullTitle": "when .body is a Stream should keep content-length if overwritten with the same stream",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  var stream = fs.createReadStream('package.json');\n  this.body = stream;\n  this.body = stream;\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:822:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "554dc374-7b31-497b-b447-e4284ad1d443",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should handle errors",
      "fullTitle": "when .body is a Stream should handle errors",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.set('Content-Type', 'application/json; charset=utf-8');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'text/plain; charset=utf-8')\n.expect(404)\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "7c11b6d7-446c-4286-b4dd-4dbce902a29f",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should handle errors when no content status",
      "fullTitle": "when .body is a Stream should handle errors when no content status",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "f18f05d1-e599-4054-bd98-49829c018941",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should handle all intermediate stream body errors",
      "fullTitle": "when .body is a Stream should handle all intermediate stream body errors",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
      "err": {},
      "isRoot": false,
      "uuid": "1eca3a5d-4713-4b21-ba8f-73e9000c8bc8",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with json",
      "fullTitle": "when .body is an Object should respond with json",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.expect('{\"hello\":\"world\"}', done);",
      "err": {},
      "isRoot": false,
      "uuid": "fa66a76c-884d-4a60-94a0-4dc6cf076331",
      "parentUUID": "63e86dab-3dd9-4d1e-9290-d85e7e08aa74",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should emit \"error\" on the app",
      "fullTitle": "when an error occurs should emit \"error\" on the app",
      "timedOut": true,
      "duration": 2001,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom');\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
      "err": {
        "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
        "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
      },
      "isRoot": false,
      "uuid": "e3c7559e-c924-4f74-8aa7-426c01f5adf1",
      "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with 500",
      "fullTitle": "when an error occurs should respond with 500",
      "timedOut": false,
      "duration": 4,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom!');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(500, 'Internal Server Error')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "5c7137ac-a4dd-4186-8344-1892f527b14c",
      "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should be catchable",
      "fullTitle": "when an error occurs should be catchable",
      "timedOut": false,
      "duration": 12,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  try {\n    yield next;\n    this.body = 'Hello';\n  } catch (err) {\n    this.body = 'Got error';\n  }\n});\napp.use(function *(next){\n  throw new Error('boom!');\n  this.body = 'Oh no';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200, 'Got error')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "17662c54-c393-4d26-be63-098c46d62661",
      "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should expose the message",
      "fullTitle": "with an .expose property should expose the message",
      "timedOut": false,
      "duration": 4,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('sorry!');\n  err.status = 403;\n  err.expose = true;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'sorry!')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "628a8677-b38d-4d03-8247-e7c05fc51f60",
      "parentUUID": "e06ac847-ddd4-4f7e-9fa7-101f833d03d1",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with .status",
      "fullTitle": "with a .status property should respond with .status",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('s3 explodes');\n  err.status = 403;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'Forbidden')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "2b970da1-6116-49d5-866b-a9f0822ce543",
      "parentUUID": "cf907981-c525-4d73-ba02-c5ccf07016a6",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should 200",
      "fullTitle": "when status and body property should 200",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = 'hello';\n  this.status = 200;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('hello', done);",
      "err": {},
      "isRoot": false,
      "uuid": "31e46d3f-26db-4a13-b376-861ccd7152a7",
      "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should 204",
      "fullTitle": "when status and body property should 204",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = 'hello';\n  this.set('content-type', 'text/plain; charset=utf8');\n  this.status = 204;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.end(function (err, res) {\n  res.should.not.have.header('content-type');\n  done(err);\n});",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:1023:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "d88d16e7-f810-49c4-8c75-926cca4f02e7",
      "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should merge properties",
      "fullTitle": "app.context should merge properties",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app1.use(function *(next){\n  assert.equal(this.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "ccd25cd5-c4c2-4e90-ad8a-4e62e5cf2d9e",
      "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not affect the original prototype",
      "fullTitle": "app.context should not affect the original prototype",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app2.use(function *(next){\n  assert.equal(this.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "bece6085-4d02-4359-ac04-23e27fd76778",
      "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should merge properties",
      "fullTitle": "app.request should merge properties",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app1.use(function *(next){\n  assert.equal(this.request.message, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "d4a3c6cb-6672-4a9a-bea1-690a1592b6cb",
      "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not affect the original prototype",
      "fullTitle": "app.request should not affect the original prototype",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app2.use(function *(next){\n  assert.equal(this.request.message, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "9a139b34-fb86-4110-aac6-7b47a266884f",
      "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should merge properties",
      "fullTitle": "app.response should merge properties",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app1.use(function *(next){\n  assert.equal(this.response.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "64bd6b1e-cfd7-40ea-b75b-a73ebf00f483",
      "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not affect the original prototype",
      "fullTitle": "app.response should not affect the original prototype",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app2.use(function *(next){\n  assert.equal(this.response.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "fc37ec66-7664-453d-b69c-7ccff3d23ae5",
      "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
      "isHook": false,
      "skipped": false
    }
  ],
  "allPending": [],
  "allPasses": [
    {
      "title": "should not .writeHead when !socket.writable",
      "fullTitle": "app should not .writeHead when !socket.writable",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  // set .writable to false\n  this.socket.writable = false;\n  this.status = 204;\n  // throw if .writeHead or .end is called\n  this.res.writeHead =\n  this.res.end = function(){\n    throw new Error('response sent');\n  };\n})\n// hackish, but the response should occur in a single tick\nsetImmediate(done);\nrequest(app.listen())\n.get('/')\n.end(function(){});",
      "err": {},
      "isRoot": false,
      "uuid": "e4b08348-010b-484d-9600-22eac21434a0",
      "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should set development env when NODE_ENV missing",
      "fullTitle": "app should set development env when NODE_ENV missing",
      "timedOut": false,
      "duration": 0,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var NODE_ENV = process.env.NODE_ENV;\nprocess.env.NODE_ENV = '';\nvar app = koa();\nprocess.env.NODE_ENV = NODE_ENV;\nassert.equal(app.env, 'development');",
      "err": {},
      "isRoot": false,
      "uuid": "e964ad37-0db4-489f-bcd8-436713cbcf2c",
      "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not error when a non-generator function is passed when .experimental=true",
      "fullTitle": "app.use(fn) should not error when a non-generator function is passed when .experimental=true",
      "timedOut": false,
      "duration": 0,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.experimental = true;\napp.use(function(){});",
      "err": {},
      "isRoot": false,
      "uuid": "5fa9b996-9292-45de-8bf2-6b059f006f36",
      "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should bypass app.respond",
      "fullTitle": "when this.respond === false should bypass app.respond",
      "timedOut": false,
      "duration": 5,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n  this.respond = false;\n  var res = this.res;\n  res.statusCode = 200;\n  setImmediate(function(){\n    res.setHeader('Content-Type', 'text/plain');\n    res.end('lol');\n  })\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('lol')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "d4757f82-922f-423b-9d41-20e0a6b52b47",
      "parentUUID": "3b1616fc-ba5a-442d-a120-56ae802163dc",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with a 404 if no body was set",
      "fullTitle": "when HEAD is used should respond with a 404 if no body was set",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(404, done);",
      "err": {},
      "isRoot": false,
      "uuid": "6ef1bf0b-8867-40dc-bfa4-235ad1edf12d",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with a 200 if body = \"\"",
      "fullTitle": "when HEAD is used should respond with a 200 if body = \"\"",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200, done);",
      "err": {},
      "isRoot": false,
      "uuid": "f3f7f9fb-97bf-4c37-aecc-19205fd3026f",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not overwrite the content-type",
      "fullTitle": "when HEAD is used should not overwrite the content-type",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.type = 'application/javascript';\n})\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect('content-type', /application\\/javascript/)\n.expect(200, done);",
      "err": {},
      "isRoot": false,
      "uuid": "3bf1473b-b0bc-4dac-aa51-d0ad0b398cd1",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should 404",
      "fullTitle": "when no middleware are present should 404",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
      "err": {},
      "isRoot": false,
      "uuid": "94d88e17-d802-4088-b956-635e5f49be12",
      "parentUUID": "921e832d-9a06-43ba-8488-8672b93ec7a4",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not cause an app error",
      "fullTitle": "when res has already been written to should not cause an app error",
      "timedOut": false,
      "duration": 4,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\")\n  }, 0);\n});\nvar errorCaught = false;\napp.on('error', function(err){\n  errorCaught = err;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  if (errorCaught) return done(errorCaught);\n  done();\n});",
      "err": {},
      "isRoot": false,
      "uuid": "b6da8b84-d370-4475-84e6-9cddc36c57ee",
      "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should send the right body",
      "fullTitle": "when res has already been written to should send the right body",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  var res = this.res;\n  this.status = 200;\n  res.setHeader(\"Content-Type\", \"text/html\")\n  res.write('Hello');\n  setTimeout(function(){\n    res.end(\"Goodbye\");\n  }, 0);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('HelloGoodbye', done);",
      "err": {},
      "isRoot": false,
      "uuid": "7d6da28f-bc95-418c-b29d-6c2dc8dad747",
      "parentUUID": "bfe949d2-efa9-41ed-958f-f388bdd33bd8",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the associated status message",
      "fullTitle": "with status=400 should respond with the associated status message",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 400;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(400)\n.expect('Content-Length', 11)\n.expect('Bad Request', done);",
      "err": {},
      "isRoot": false,
      "uuid": "0c9b02ab-8946-4bfe-930d-4603bab209d7",
      "parentUUID": "6925725c-45d6-42e2-9a52-3c248ad805d8",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the status code number",
      "fullTitle": "with custom status without message should respond with the status code number",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.res.statusCode = 701;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(701)\n.expect('701', done);",
      "err": {},
      "isRoot": false,
      "uuid": "3114e1f2-b55e-4d61-a27b-680675c653b6",
      "parentUUID": "3f7483f0-5dba-488d-8557-72936d3464d9",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond",
      "fullTitle": "when .body is a string should respond",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
      "err": {},
      "isRoot": false,
      "uuid": "bc9fa573-ae08-4316-9eff-e1ebe2fc36a1",
      "parentUUID": "d8ecf142-2453-441f-9da0-22f40d6d64d1",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond",
      "fullTitle": "when .body is a Buffer should respond",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('Hello');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Hello', done);",
      "err": {},
      "isRoot": false,
      "uuid": "a40214c7-e8ac-416e-a48c-60b9457dfc65",
      "parentUUID": "b167cf4c-8c81-4223-877a-d6835f67277e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should handle errors",
      "fullTitle": "when .body is a Stream should handle errors",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.set('Content-Type', 'application/json; charset=utf-8');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'text/plain; charset=utf-8')\n.expect(404)\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "7c11b6d7-446c-4286-b4dd-4dbce902a29f",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should handle errors when no content status",
      "fullTitle": "when .body is a Stream should handle errors when no content status",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "f18f05d1-e599-4054-bd98-49829c018941",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should handle all intermediate stream body errors",
      "fullTitle": "when .body is a Stream should handle all intermediate stream body errors",
      "timedOut": false,
      "duration": 3,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n  this.body = fs.createReadStream('does not exist');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404, done);",
      "err": {},
      "isRoot": false,
      "uuid": "1eca3a5d-4713-4b21-ba8f-73e9000c8bc8",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with json",
      "fullTitle": "when .body is an Object should respond with json",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.expect('{\"hello\":\"world\"}', done);",
      "err": {},
      "isRoot": false,
      "uuid": "fa66a76c-884d-4a60-94a0-4dc6cf076331",
      "parentUUID": "63e86dab-3dd9-4d1e-9290-d85e7e08aa74",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with 500",
      "fullTitle": "when an error occurs should respond with 500",
      "timedOut": false,
      "duration": 4,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom!');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(500, 'Internal Server Error')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "5c7137ac-a4dd-4186-8344-1892f527b14c",
      "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should be catchable",
      "fullTitle": "when an error occurs should be catchable",
      "timedOut": false,
      "duration": 12,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  try {\n    yield next;\n    this.body = 'Hello';\n  } catch (err) {\n    this.body = 'Got error';\n  }\n});\napp.use(function *(next){\n  throw new Error('boom!');\n  this.body = 'Oh no';\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200, 'Got error')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "17662c54-c393-4d26-be63-098c46d62661",
      "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should expose the message",
      "fullTitle": "with an .expose property should expose the message",
      "timedOut": false,
      "duration": 4,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('sorry!');\n  err.status = 403;\n  err.expose = true;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'sorry!')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "628a8677-b38d-4d03-8247-e7c05fc51f60",
      "parentUUID": "e06ac847-ddd4-4f7e-9fa7-101f833d03d1",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with .status",
      "fullTitle": "with a .status property should respond with .status",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  var err = new Error('s3 explodes');\n  err.status = 403;\n  throw err;\n});\nrequest(app.listen())\n.get('/')\n.expect(403, 'Forbidden')\n.end(done);",
      "err": {},
      "isRoot": false,
      "uuid": "2b970da1-6116-49d5-866b-a9f0822ce543",
      "parentUUID": "cf907981-c525-4d73-ba02-c5ccf07016a6",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should 200",
      "fullTitle": "when status and body property should 200",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = 'hello';\n  this.status = 200;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('hello', done);",
      "err": {},
      "isRoot": false,
      "uuid": "31e46d3f-26db-4a13-b376-861ccd7152a7",
      "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should merge properties",
      "fullTitle": "app.context should merge properties",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app1.use(function *(next){\n  assert.equal(this.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "ccd25cd5-c4c2-4e90-ad8a-4e62e5cf2d9e",
      "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not affect the original prototype",
      "fullTitle": "app.context should not affect the original prototype",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app2.use(function *(next){\n  assert.equal(this.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "bece6085-4d02-4359-ac04-23e27fd76778",
      "parentUUID": "b8d23ff1-a585-4ae2-95d9-ece56b18d1e7",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should merge properties",
      "fullTitle": "app.request should merge properties",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app1.use(function *(next){\n  assert.equal(this.request.message, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "d4a3c6cb-6672-4a9a-bea1-690a1592b6cb",
      "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not affect the original prototype",
      "fullTitle": "app.request should not affect the original prototype",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app2.use(function *(next){\n  assert.equal(this.request.message, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "9a139b34-fb86-4110-aac6-7b47a266884f",
      "parentUUID": "a16a3817-0938-4790-865d-7a521f5b6811",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should merge properties",
      "fullTitle": "app.response should merge properties",
      "timedOut": false,
      "duration": 2,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app1.use(function *(next){\n  assert.equal(this.response.msg, 'hello')\n  this.status = 204\n});\nrequest(app1.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "64bd6b1e-cfd7-40ea-b75b-a73ebf00f483",
      "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not affect the original prototype",
      "fullTitle": "app.response should not affect the original prototype",
      "timedOut": false,
      "duration": 1,
      "state": "passed",
      "speed": "fast",
      "pass": true,
      "fail": false,
      "pending": false,
      "code": "app2.use(function *(next){\n  assert.equal(this.response.msg, undefined)\n  this.status = 204;\n});\nrequest(app2.listen())\n.get('/')\n.expect(204, done);",
      "err": {},
      "isRoot": false,
      "uuid": "fc37ec66-7664-453d-b69c-7ccff3d23ae5",
      "parentUUID": "17a13e9c-3047-4ffb-beeb-ed9fe84f58dd",
      "isHook": false,
      "skipped": false
    }
  ],
  "allFailures": [
    {
      "title": "should handle socket errors",
      "fullTitle": "app should handle socket errors",
      "timedOut": true,
      "duration": 2007,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(next){\n  // triggers this.socket.writable == false\n  this.socket.emit('error', new Error('boom'));\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
      "err": {
        "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
        "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
      },
      "isRoot": false,
      "uuid": "641c0b23-c5ca-4d08-b4fc-f980769e69a1",
      "parentUUID": "411ce8c7-20dc-493b-bb5a-4398763acc7f",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should work",
      "fullTitle": "app.toJSON() should work",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar obj = app.toJSON();\nobj.should.eql({\n  subdomainOffset: 2,\n  proxy: false,\n  env: 'test'\n});",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:69:15)"
      },
      "isRoot": false,
      "uuid": "a28e7671-a15e-423a-9761-1ec60dec35c2",
      "parentUUID": "8b74cd26-5c31-4d9b-ba0d-6f4668b6e1a0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should work",
      "fullTitle": "app.inspect() should work",
      "timedOut": false,
      "duration": 3,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar util = require('util');\nvar str = util.inspect(app);\nassert.equal(\"{ subdomainOffset: 2, proxy: false, env: 'test' }\", str);",
      "err": {
        "message": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'",
        "estack": "AssertionError: '{ subdomainOffset: 2, proxy: false, env: \\'test\\' }' == '{ subdomainOffset: 2, proxy: false, env: \\'undefined\\' }'\n    at Context.<anonymous> (test/application.js:82:12)",
        "diff": "- { subdomainOffset: 2, proxy: false, env: 'test' }\n+ { subdomainOffset: 2, proxy: false, env: 'undefined' }\n"
      },
      "isRoot": false,
      "uuid": "a0d003d7-8d34-4ca1-823e-32626b3b20c6",
      "parentUUID": "73350234-abae-45dd-abb8-ca709c897710",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should compose middleware",
      "fullTitle": "app.use(fn) should compose middleware",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar calls = [];\napp.use(function *(next){\n  calls.push(1);\n  yield next;\n  calls.push(6);\n});\napp.use(function *(next){\n  calls.push(2);\n  yield next;\n  calls.push(5);\n});\napp.use(function *(next){\n  calls.push(3);\n  yield next;\n  calls.push(4);\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(404)\n.end(function(err){\n  if (err) return done(err);\n  calls.should.eql([1,2,3,4,5,6]);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Test.<anonymous> (test/application.js:116:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "8177e9bf-2589-412e-a46b-28d20c145fe2",
      "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should error when a non-generator function is passed",
      "fullTitle": "app.use(fn) should error when a non-generator function is passed",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\ntry {\n  app.use(function(){});\n} catch (err) {\n  err.message.should.equal('app.use() requires a generator function');\n}",
      "err": {
        "message": "TypeError: Cannot read property 'equal' of undefined",
        "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Context.<anonymous> (test/application.js:127:25)"
      },
      "isRoot": false,
      "uuid": "69805d01-fc25-433e-bde6-80ff8a3c3c4c",
      "parentUUID": "c8aa0af5-0b1c-4acb-8a39-3e49694b97b0",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should throw an error if a non-error is given",
      "fullTitle": "app.onerror(err) should throw an error if a non-error is given",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\ntry {\n  app.onerror('foo');\n  should.fail();\n} catch (err) {\n  err.should.be.instanceOf(AssertionError);\n  err.message.should.equal('non-error thrown: foo');\n}\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'be' of undefined",
        "estack": "TypeError: Cannot read property 'be' of undefined\n    at Context.<anonymous> (test/application.js:147:17)"
      },
      "isRoot": false,
      "uuid": "358fb66c-7786-4af2-b5b1-96f23f6a2f02",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should do nothing if status is 404",
      "fullTitle": "app.onerror(err) should do nothing if status is 404",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nvar err = new Error();\nerr.status = 404;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:164:18)"
      },
      "isRoot": false,
      "uuid": "fd7cbfdd-5741-4f08-94aa-396404120cd7",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should do nothing if .silent",
      "fullTitle": "app.onerror(err) should do nothing if .silent",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.silent = true;\nvar err = new Error();\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:178:18)"
      },
      "isRoot": false,
      "uuid": "0ddf2c30-9286-4d0b-a67d-5143b9dc0ac8",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should log the error to stderr",
      "fullTitle": "app.onerror(err) should log the error to stderr",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error();\nerr.stack = 'Foo';\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Foo\\n\", \"\\n\"]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:194:18)"
      },
      "isRoot": false,
      "uuid": "29e363fd-acdc-41e7-a1b3-ae26973e084b",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should use err.toString() instad of err.stack",
      "fullTitle": "app.onerror(err) should use err.toString() instad of err.stack",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.env = 'dev';\nvar err = new Error('mock stack null');\nerr.stack = null;\nvar output = stderr.inspectSync(function() {\n  app.onerror(err);\n});\noutput.should.eql([\"\\n\", \"  Error: mock stack null\\n\", \"\\n\"]);\ndone();",
      "err": {
        "message": "TypeError: Cannot read property 'eql' of undefined",
        "estack": "TypeError: Cannot read property 'eql' of undefined\n    at Context.<anonymous> (test/application.js:210:18)"
      },
      "isRoot": false,
      "uuid": "d9915255-f6ab-458b-a2e4-abba6291c7d7",
      "parentUUID": "1a701163-3898-4eba-9461-92eeb1d03021",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not send Content-Type header",
      "fullTitle": "when this.type === null should not send Content-Type header",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = '';\n  this.type = null;\n});\nvar server = app.listen();\nrequest(server)\n  .get('/')\n  .expect(200)\n  .end(function(err, res){\n    if (err) return done(err);\n    res.should.not.have.header('content-type');\n    done();\n  });",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:259:21)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "ccf23d22-a600-4811-b314-92ca7556169d",
      "parentUUID": "23a00d81-2f84-437a-826c-57438095502a",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should not respond with the body",
      "fullTitle": "when HEAD is used should not respond with the body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'Hello';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '5');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:280:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "bb622080-4d63-41a1-ab8c-8b4b08159a36",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep json headers",
      "fullTitle": "when HEAD is used should keep json headers",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = { hello: 'world' };\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/json; charset=utf-8');\n  res.should.have.header('Content-Length', '17');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:301:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "3925ce76-d623-4aa5-959d-fa570174ad3a",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep string headers",
      "fullTitle": "when HEAD is used should keep string headers",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello world';\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'text/plain; charset=utf-8');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:322:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "8f285de3-8c37-4264-be1c-b8a01df76d10",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep buffer headers",
      "fullTitle": "when HEAD is used should keep buffer headers",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = new Buffer('hello world');\n});\nvar server = app.listen();\nrequest(server)\n.head('/')\n.expect(200)\n.end(function(err, res){\n  if (err) return done(err);\n  res.should.have.header('Content-Type', 'application/octet-stream');\n  res.should.have.header('Content-Length', '11');\n  assert(0 == res.text.length);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:343:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "dba5488f-3190-4f5e-8f36-d78d7083f058",
      "parentUUID": "d92a162e-05ff-4fc3-bb69-d93535b6a23e",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond without a body",
      "fullTitle": "with status=204 should respond without a body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 204;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:497:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "7b05533d-7565-4c3c-aa62-f5d7909327d5",
      "parentUUID": "dd9f8e31-a5c0-478b-adee-fda9f25ef136",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond without a body",
      "fullTitle": "with status=205 should respond without a body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:520:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "e87e9832-d786-46da-a15b-466e0abefe27",
      "parentUUID": "71adb34d-5a70-4749-a456-3c5ea7b73829",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond without a body",
      "fullTitle": "with status=304 should respond without a body",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:543:28)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "71c6bbea-6258-48b5-875b-c0f2c200cbb4",
      "parentUUID": "58c6ba24-57cf-4b09-8342-d5724b82f915",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the associated status message",
      "fullTitle": "with custom status=700 should respond with the associated status message",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\nstatuses['700'] = 'custom status';\napp.use(function *(){\n  this.status = 700;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(700)\n.expect('custom status')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('custom status');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'equal' of undefined",
        "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:566:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "e5c9fd56-ad41-49f2-aff2-23f8a8411fa6",
      "parentUUID": "416b1609-f46a-4b50-8db7-0497cc2a6304",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond with the custom status message",
      "fullTitle": "with custom statusMessage=ok should respond with the custom status message",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.message = 'ok';\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(200)\n.expect('ok')\n.end(function(err, res){\n  if (err) return done(err);\n  res.res.statusMessage.should.equal('ok');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'equal' of undefined",
        "estack": "TypeError: Cannot read property 'equal' of undefined\n    at Test.<anonymous> (test/application.js:589:39)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "29ab484f-8f19-491b-aac1-1fdcfdfd9559",
      "parentUUID": "57bb4eb5-b05d-440a-a92d-a99a4f06d017",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 204 by default",
      "fullTitle": "when .body is a null should respond 204 by default",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:630:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "b7402624-ec75-441b-ad31-d1e9159e7014",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 204 with status=200",
      "fullTitle": "when .body is a null should respond 204 with status=200",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:652:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "39c70370-d62b-4dbc-89d6-952cc9c01731",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 205 with status=205",
      "fullTitle": "when .body is a null should respond 205 with status=205",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 205;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(205)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:674:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "3d5d0271-e30d-4c5f-92cd-033021b7919e",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond 304 with status=304",
      "fullTitle": "when .body is a null should respond 304 with status=304",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 304;\n  this.body = null;\n})\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(304)\n.expect('')\n.end(function(err, res){\n  if (err) return done(err);\n  res.header.should.not.have.property('content-type');\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:696:26)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:703:3)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "875a0ba6-7cd8-4294-929a-5aea9f204049",
      "parentUUID": "72398050-29e3-42cb-bcf5-bb4442d2248c",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should respond",
      "fullTitle": "when .body is a Stream should respond",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n});",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:751:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "30982b89-8d6b-46a5-9c76-70514fa0f427",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should strip content-length when overwriting",
      "fullTitle": "when .body is a Stream should strip content-length when overwriting",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.body = 'hello';\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.not.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:774:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "f49ef151-c121-4540-969d-40e089d51e4e",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep content-length if not overwritten",
      "fullTitle": "when .body is a Stream should keep content-length if not overwritten",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  this.body = fs.createReadStream('package.json');\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:797:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "c36dd382-6b77-4f58-b8bd-bbbdf0d8d23c",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should keep content-length if overwritten with the same stream",
      "fullTitle": "when .body is a Stream should keep content-length if overwritten with the same stream",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.length = fs.readFileSync('package.json').length;\n  var stream = fs.createReadStream('package.json');\n  this.body = stream;\n  this.body = stream;\n  this.set('Content-Type', 'application/json; charset=utf-8');\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect('Content-Type', 'application/json; charset=utf-8')\n.end(function(err, res){\n  if (err) return done(err);\n  var pkg = require('../package');\n  res.should.have.header('Content-Length');\n  res.body.should.eql(pkg);\n  done();\n})",
      "err": {
        "message": "TypeError: Cannot read property 'have' of undefined",
        "estack": "TypeError: Cannot read property 'have' of undefined\n    at Test.<anonymous> (test/application.js:822:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "554dc374-7b31-497b-b447-e4284ad1d443",
      "parentUUID": "d063c7b5-4ec0-4a45-b996-ecc9b60005df",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should emit \"error\" on the app",
      "fullTitle": "when an error occurs should emit \"error\" on the app",
      "timedOut": true,
      "duration": 2001,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  throw new Error('boom');\n});\napp.on('error', function(err){\n  err.message.should.equal('boom');\n  done();\n});\nrequest(app.listen())\n.get('/')\n.end(function(){});",
      "err": {
        "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves.",
        "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves."
      },
      "isRoot": false,
      "uuid": "e3c7559e-c924-4f74-8aa7-426c01f5adf1",
      "parentUUID": "41f2c022-75a1-4028-bd45-800ca80631a2",
      "isHook": false,
      "skipped": false
    },
    {
      "title": "should 204",
      "fullTitle": "when status and body property should 204",
      "timedOut": false,
      "duration": 0,
      "state": "failed",
      "pass": false,
      "fail": true,
      "pending": false,
      "code": "var app = koa();\napp.use(function *(){\n  this.status = 200;\n  this.body = 'hello';\n  this.set('content-type', 'text/plain; charset=utf8');\n  this.status = 204;\n});\nvar server = app.listen();\nrequest(server)\n.get('/')\n.expect(204)\n.end(function (err, res) {\n  res.should.not.have.header('content-type');\n  done(err);\n});",
      "err": {
        "message": "TypeError: Cannot read property 'not' of undefined",
        "estack": "TypeError: Cannot read property 'not' of undefined\n    at Test.<anonymous> (test/application.js:1023:19)\n    at Test.assert (node_modules/supertest/lib/test.js:156:6)\n    at assert (node_modules/supertest/lib/test.js:127:12)\n    at node_modules/supertest/lib/test.js:124:5\n    at Test.Request.callback (node_modules/superagent/lib/node/index.js:691:12)\n    at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:922:12)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)"
      },
      "isRoot": false,
      "uuid": "d88d16e7-f810-49c4-8c75-926cca4f02e7",
      "parentUUID": "03af4ac5-c025-43bc-ae7c-d947d0400cc5",
      "isHook": false,
      "skipped": false
    }
  ],
  "copyrightYear": 2017
}